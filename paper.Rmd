---
title: |
  A slice tour for finding hollowness in high-dimensional data
type: Short Technical Note
author:
  - name: Ursula Laa
    affil: a, b
    email: ursula.laa@monash.edu
  - name: Dianne Cook
    affil: b
    email: dicook@monash.edu
affiliation:
  - num: a
    address: |
      School of Physics and Astronomy, Monash University
  - num: b
    address: |
      Department of Econometrics and Business Statistics, Monash University
bibliography: biblio.bib
abstract: |
  Projections and sectioning are complementary methods for the visualisation of
  high-dimensional data. In this note we describe slicing in the orthogonal
  space of projections obtained when running a tour, thus presenting the viewer
  with an interpolated sequence of projected sections. The method has been
  implemented in R as an extension to the tourr package, and can be used to
  explore concave structures in multivariate distributions.
keywords: |
  data visualisation; grand tour; sectioning
header-includes: |
  \usepackage{hyperref}
  \usepackage[utf8]{inputenc}
  \def\tightlist{}
output: rticles::tf_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

# Introduction

<!-- Background -->
Modern data is typically high-dimensional and thus data visualisation often relies on some form of dimension reduction. This entails looking at linear projections of the data, or nonlinear if one considers techniques like multidimensional scaling (MDS) or t-Distributed Stochastic Neighbor Embedding (t-SNE). For our purposes we focus on linear projections. Interactive and dynamic displays can provide information beyond what can be achieved in a static display. For example, the grand tour [@As85; @BCAH05] shows a smooth sequence of interpolated lower dimensional projections and allows the viewer to extrapolate from the low-dimensional shapes to the multidimensional distribution. It is particularly useful for detecting clusters, outliers and non-linear dependence. 

<!-- The disadvantage of projection: opacity, occlusion, even with pseudo-transparency from scatterplots;  motivation -->
A major limitation of projections is their opacity, even if mitigated somewhat through the pseudo-transparancy present in sparse scatterplots. As a result certain features of distributions may easily be hidden in projections, especially in the case of concave structures. Considering the example of a simple geometric shape such as a hypershere, we understand that projections cannot distinguish between a full or a hollow sphere. Similarly we can think of small scale structures hidden in the center of a multivariate distribution. Again projections will not help in findig such features in a distribution. Other examples where the use of projections is limited include the visualisation of non-linear boundaries between groups, that will be obscured in each projection.

<!-- Our approach: introduce sections; many different ways to slice, refer to linked brushing as slicing whcih mirrors prosection, but here we will explain/utilise a simple slicing on the projection where point in orthogonal space are faded. -->
We can overcome these limitations when adding section information, see e.g. @prosection. For our example of the hypersphere, we can clearely identify a hollow sphere when looking at a slice throught the distribution, where all points will lie on a circle in a 2d slice. In practice there are many different ways to slice, typically facilitated through linked brushing (e.g. @ggobiCSDA2003, @JSSv081i05), where the user is selecting a region in a subspace of the dataspace that is highlighted in a projection of the data points. These systems are interactive, and rely on the user to redefine the section many times to fully explore the data in this way. In this note we introduce a simple slicing method for projections where points in the orthogonal space are faded. Combining it with the grand tour results in a new dynamic display that can be used to systematically search for features hidden in sections.


<!-- paper structure --> 
The method and its implementation in R are described in Section XXX, and in Section XXX. We then apply it to several examples in Section XXX. We consider different high-dimensional geometric shapes and XXX, showing how concave or occluded structures can be visualised and explored with a slice tour. Possible extensions are discussed in Section XXX.

# Method

The basis underlying our approach is the grand tour. We first briefly review the relevant concepts. Building on these ideas we introduce a method for displaying slices of parameter space that are defined for each projection matrix.

## Tour review

A tour is providing a continuous animation, showing a sequence of $d$-dimensional (typically $d=1$ or $2$) projections from $n$-dimensional parameter space. The tour combines basis selection with basis interpolation. In a grand tour the basis selection is random (each new basis is chosen from all possible projections), and typically geodesic interpolation is used to generate smooth transitions between viewing planes. Different basis selection methods as well as the geodesic interpolation are implemented in the `tourr` package [@tourr] in R [@rref], which also provides several display functions for viewing the tour.

The notation used in the following for the description of each projection is denoting $\mathbf{X}$ the $m\times n$ dimensional data matrix ($m$ observations in $n$ dimensions) and $\mathbf{A}$ an orthonormal $n \times d$ projection matrix. The $d$-dimensional projection of the data is thus given by $\mathbf{Y} = \mathbf{X}\cdot\mathbf{A}$, giving the $n\times d$ dimensional projected data matrix to be plotted in each frame of the tour display.

In the following we are interested in the orthogonal distance of scatter points from an anchored projection plane, thus $d=2$. 

## Slicing in the orthogonal space

### Distance from the origin

In addition to the projected data $\mathbf{Y}$ we calculate for each projection the orthogonal distance of the data points from the current projection plane centered at the origin, $v$. The orthogonal component is given by
\begin{equation}
x_i' = x_i - (x_i\cdot a_1) a_1 - (x_i\cdot a_2) a_2
\end{equation}
with $x_i, i=1,...,m$ an $n$-dimensional observation in $\mathbf{X}$ and $a_i, i=1,2$ denoting the columns of the projection matrix, $\mathbf{A}=(a_1, a_2)$.
Calculating the euclidean norm of $x'$ is straightforward thanks to the orthonormality of $\mathbf{A}$, and gives the components of the required distance vector.
\begin{equation}
\tilde{v}_i^2 = ||x_i'||^2 = x_i^2 - (x_i\cdot a_1)^2 - (x_i\cdot a_2)^2.
\end{equation}
We also see that this is trivially generalizing for orthonormal projection matrices with $d>2$.

The distance vector can then be used to display a slice tour by highlighting points for which the orthogonal distance is smaller than a selected cutoff value $h$. In general a larger cutoff value and/or much larger sample sizes are required as the original dimensionality ($n$) increases. For practical purposes we therefore specify a volume $\epsilon$ and then use as a cutoff $h = \epsilon^{1/n}$.

```{r renderFunction, echo=FALSE, eval=TRUE, warning=FALSE, fig.height=1.5, fig.width = 5.5, fig.cap="Projected slices through 4d geometric shapes. On the left a full (hollow) hypersphere (a, b), on the right a full (hollow) hypercube (c, d). Points inside the slice are shown as black bullets, points outside the slice are shown as grey dots. We can clearly distinguish the full from the hollow objects based on the slice display."}
library(tidyverse)

# slight modification of the function in tourr::display_slice
render_data <- function(data, proj, h, anchor) {
    # Render projected points
    x <- data %*% proj
    d <- tourr::anchored_orthogonal_distance(proj, data, anchor)
    pch <- rep(46, nrow(x))
    pch[d < h] <- 20
    col <- rep("grey", nrow(x))
    col[d < h] <- "black"
    ggplot() +aes(x[,1], x[,2]) + geom_point(pch = pch, color=col) + theme_void() + coord_fixed()
}

anchor <- rep(0, 4)
plane <- tourr::basis_init(4, 2)
nPt <- 5000

set.seed(3008)

d1 <- geozoo::sphere.solid.random(4, nPt)$points
d2 <- geozoo::sphere.hollow(4, nPt)$points
d3 <- geozoo::cube.solid.random(4)$points[1:nPt,] %>% scale(scale = FALSE)
d4 <- geozoo::cube.face(4)$points[1:nPt,] %>% scale(scale = FALSE)


a <- render_data(d1, plane, 0.2, anchor) + labs(title="a")
b <- render_data(d2, plane, 0.2, anchor) + labs(title="b")
c <- render_data(d3, plane, 0.2, anchor) + labs(title="c")
d <- render_data(d4, plane, 0.2, anchor) + labs(title="d")

library(gridExtra)
grid.arrange(a, b, c, d, nrow=1)

```


### Slice thickness

Choosing the slice thickness is a compromise between what feature size can be revealed and how many points fall inside a thin slice. As dimensionality increases, the relative number of points that are inside a slice of fixed thickness will decrease. The exact relation depends heavily on the distribution of the data points. Here we present expressions for spectial cases to get an idea of this scaling.

We first consider as a simple example a hypercube that is sliced along two of the paremeters (note that a cube is not rotation invariant). To estimate the relative number of points in a slice of thickness $2h$ we calculate the relative volume of the slice compared to the full hypercube:
\begin{equation}
V_{rel} = \frac{V_{slice}}{V_{cube}} = \frac{(2r)^2 * (2h)^{p-2}}{(2r)^p} = (\frac{h}{r})^{p-2},
\end{equation}
where the cube side lenght is $2r$. Thus if we want to keep the relative number of points (i.e. $V_{rel}$) constant for slices in different $p$ we calculate $h$ from a fixed volume parameter as $h = \epsilon^{1/(p-2)}$.

Considering now slicing through a multivariate normal, we can estimate the number of points in a slice by integrating the probability distribution with boundaries $\pm h$ in $p-2$. In this case the relative density scales with the error function as
\begin{equation}
\rho_{rel} = \pi^{(2-p)/2} \mathrm{erf}((h/\sqrt 2 \sigma)) ^{p-2}.
\end{equation}

XXX two plots: vrel/rhorel scaling with h for n for p = 3, 4, 5, 10, and h scaling with p for vrel = 0.001, 0.01, 0.05 and 0.1

### Anchoring

The above definition implicitly assumes that we slice the distribution using the origin as a reference point. This is generally a good starting point assuming the data is centered before applying the slice tour. Alternative reference points can however provide additional insight into the concave structure of the distribution. We can also use the mean in each parameter as an anchor point if the data is not centered.

We therefore generalize the distance vector to measure the anchored orthogonal distance, i.e. distance with respect to the anchor $\alpha$ used as a reference point.

In general $\alpha$ can be any point in the $n$-dimensional parameter space, but we are only interested in the orthogonal component, thus we use $\alpha' = \alpha - (\alpha\cdot a_1) a_1 - (\alpha\cdot a_2 )a_2$ to define the generalized measure of orthogonal distance as
\begin{equation}
v_i^2 = ||x_i' - \alpha'||^2 = x_i'^2 + \alpha'^2 - 2 x_i'\cdot\alpha'
\end{equation}

where the cross term can be expressed as

\begin{equation}
x_i'\cdot\alpha' = x_i\cdot\alpha - (\alpha\cdot a_1) (x_i\cdot a_1) - (\alpha\cdot a_2) (x_i\cdot a_2).
\end{equation}

Using the generalized distance measure with a cutoff volume $\epsilon$ then corresponds to moving a slice of fixed thickness to be centered around the anchor point $\alpha$ in the space orthogonal to the current projection plane. In three dimensions this simply corresponds to moving up or down along the orthogonal direction.



# Implementation

The slice tour has been implemented in R [@rref] as a new display method `display_slice` in the `tourr` package [@tourr]. In addition to usual parameters the user can choose the volume parameter $\epsilon$ by setting `eps` and, if required, the anchor point $\alpha$ is set by the `anchor` argument. By default `eps=0.001` and `anchor=NULL`, resulting in slicing through the origin. In addition the user can select the marker symbols for point inside and outside the slice. By default points in the slice are highlighted as `pch_slice  = 20` and `pch_other = 46`, i.e. plotting a bullet for points inside the slice, and a dot for points outside.

```{r codeExampel, echo=TRUE, eval=FALSE}
library(tourr)
# use geozoo to generate points on a hollow 3d sphere
sphere3 <- geozoo::sphere.hollow(3)$points
colnames(sphere3) <- c("x1", "x2", "x3") # naming variables
# slice tour animation with default settings
animate_slice(sphere3)
# trying an off-center anchor point, thicker slice, and
# we use pch=26 to hide points outside the slice
anchor3 <- rep(0.7, 3)
animate_slice(sphere3, anchor = anchor3, eps = 0.005, pch_other=26)
```

# Examples

XXX choose 6

To demonstrate the slice tour we sample points on the surface of a sphere with radius $r=1$ in $n=3$ and $n=5$ dimensions. We use the `geozoo` package [@geozoo] to draw 2000 (5000) points on the 3d (5d) sphere.

For both examples we start by slicing through the origin with the default parameters, in particular $\epsilon = 0.001$, i.e. $h = 0.1$ in 3d and $h = 0.25$ in 5d. Slicing through the origin results in sections where the points inside the slice are approximately on a circle with the full radius. Snapshots of the slice tour animation are shown in Figure \ref{fig:centered}, animated gifs are available at XXX. Notice that the larger number of points and increased thickness parameter $h$ do not make up for the reduced number of points inside the slice through the 5d hypersphere. (projected points are on average closer to the center as we increase the dimension of the hypersphere, is there some convergence similar to central limit theorem at play?)

\begin{figure*}[ht]
\centerline{\includegraphics[width=0.3\textwidth]{gifs/png/sphere-3-centered-055.png}\hspace{1cm}
\includegraphics[width=0.3\textwidth]{gifs/png/sphere-5-centered-055.png}}
\caption{Slice through a 3d (left) and 5d (right) hollow sphere, anchored at the origin. Points inside the slice are highlighted with a bullet marker and are found on a circle with the radius of the hypersphere, $r$.}
\label{fig:centered}
\end{figure*}

It is also instructive to look at the sliced spheres with an off-center anchor point. In this case the different views obtained in the slice tour reveal more of the concave structure of the distribution. Figure \ref{fig:3anchored} shows example views from a slice tour on a 3d sphere with $r=1$ and anchor point $(0.7, 0.7, 0.7)$. Notice that the anchor point was chosen to fall outside the sphere. Depending on the viewing angle selected by the tour the slice contains points on the circle with radius $r$ (when the anchor point has a negligible orthogonal component to the viewing plane); a circle with radius $<r$ as the viewing angle is tilted away from the axis connecting the anchor point to the origin; a full circle with small radius as the angle increases; and finally we see an empty slice when the projection plane is orthogonal to the anchor point axis.


\begin{figure*}[ht]
\centerline{\includegraphics[width=0.3\textwidth]{gifs/png/sphere-3-anchored-033.png}
\includegraphics[width=0.3\textwidth]{gifs/png/sphere-3-anchored-036.png}
\includegraphics[width=0.3\textwidth]{gifs/png/sphere-3-anchored-041.png}}
\caption{Different slices through a 3d hollow sphere with $r=1$, with anchor point $(0.7, 0.7, 0.7)$, showing full circle with small radius (left), circle with radius $<r$ (middle) and circle with radius $r$ (right).}
\label{fig:3anchored}
\end{figure*}

The same behavior is observed when slicing the 5d hollow sphere with an off-center anchor point, however a large number of sample points is required to get a similarly clear display to that found for the 3d sphere. The animation showing the anchored slice tour of the 5d hollow sphere with 5000 sample points is available at XXX. In this example the anchor point was fixed to $(0.5,0.5,0.5,0.5,0.5)$.

# Summary and Outlook

In this note we introduce a new visualization method for systematic slicing of high-dimensional parameter spaces, based on interpolated projections obtained in a grand tour. The application to the hollow sphere demonstrates the potential of this new display to find and explore concave structures in distributions.

In applications with large number of dimensions and where only a few samples are available the method is limited. In this case thick slices may be needed to get a sufficient number of observations inside the slice, and as a result  small scale concavities cannot be resolved in the slice tour. If on the other hand a large number of samples are available one may consider displaying only points inside the slice to keep a clear display.

Instead of slicing in the full $n-d=n-2$ dimensional orthogonal space we can also use a subspace in which to slice. As pointed out in @prosection combining projections with sectioning in varying numbers of dimensions can reveal the codimension of an unknown distribution. One approach would be to interpolate between projection matrices with more than two columns, and use the first two for the display projection. The remaining directions then provide an orthogonal subspace that can be used for sectioning. A subtlety to consider is that geodesic interpolation is not ideal for such applications, as it ignores rotations between the directions in the projection matrix. As alternative interpolation methods are not currently available in the R implementation, we leave such extensions for future work.

We also expect interesting new developments by combining the slice tour and the guided tour into a weighted guided tour with index functions using the distance vector information in addition to the projected data points.
